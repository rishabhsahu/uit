<html>
	<head>
		<title>Site under Construction</title>
		<meta charset="utf-8">
    		<meta http-equiv="X-UA-Compatible" content="IE=edge">
    		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css' type='text/css' rel='stylesheet'>
		<style>

			@font-face {
				font-family: Poppins;
				src: url(fonts/Poppins-Regular.ttf);
			}

			@font-face {
				font-family: notosans;
				src: url(fonts/NotoSans-Regular.ttf);
			}

			* {
				font-family: notosans;
			}

			body {
				background-color:rgba(180,180,180,.3);
			}

			#navbar {
				width: 100%;
				position:fixed;
				height: 50px;
				background-color: rgba(151,94,151,1);
				border-color: white;
				box-shadow: 0px 2px 15px rgb();
				z-index: 1;
				box-shadow: 2px 1px 30px white;
			}


			#company {
				margin-top: 14px;
				border-radius: 5px;
			}

			.panel {
				color: grey;
				background-color: white;
				position: relative;
				top: 80px;
				padding-top: 10px;
				padding-bottom: 10px;
				border-radius: 3px;
				box-shadow: 0px 2px 10px grey;
				margin-right: -7%;
			}


			a:hover {
				cursor: pointer;
			}

			.circle {
				position: relative;
				top: 25px;
				padding: 20px;
				display: inline;
				border-color: rgba(214,78,189,.5);
				border-radius: 50% 50% 50%;
				border-style: solid;
			}

			.panel1 {
				margin-left: 6.5%;
			}

			.panel2 {
				height: 35%;
				min-height: 205px;
				overflow-x: auto;
			}

			.panel_dept_info {
        min-height: 250px;
				overflow-x: auto;
			}

      .time_table {
        height: 13%;
			}

			.panel_staff {
				height: 50%;
				min-height: 200px;
				overflow-x: auto;
			}


			.class_info {
				height: 70%;
				overflow-x: auto;
			}

			.student_list {
				overflow-x: auto;
			}

			.left {
				margin-right: -2%;
			}

			a:hover {
				text-decoration: none;
			}

			.names:hover {
				cursor: pointer;
			}

		</style>		<script type='text/javascript'>

		var view ={
					home: "<div class='col-md-9 col-xs-10 col-xs-12 left'> <div class='row'> <div style='overflow-y:hidden;background-color:rgba(151,94,151,1);' class='col-md-5 col-xs-12 col-xs-offset-1 panel panel2 text-center'> <div class='row'><h5 style='color:black;display:block;margin-top:0;font-weight:bold;font-size:22px;' class='classHead0'>Class X</h5></div><div class='row class_info' style='display:block;background-color:white;font-size:110%;'> <div class='col-xs-6 text-center'>subject:</div><div class='col-xs-6 text-danger' id='subject0'></div><br><br><div class='col-xs-6 text-center'>strength:</div><div class='col-xs-6' id='strength0'></div><br><br><div class='col-xs-6 text-center'>classes held:</div><div class='col-xs-6' id='classesHeld0'></div><br><br><div class='col-xs-6 text-center'>first class:</div><div class='col-xs-6' id='firstClass0'></div></div><div class='col-xs-12 text-center' style='font-size:110%;font-weight:bold;margin-top:4px;'> <div style='border-radius:2px;cursor:pointer;color:black' class='col-xs-6' ><button id='classX' style='background-color:rgba(151,94,151,1);border-color:black;border-radius:3px' class='ripple'>attendance</button></div><div style='border-radius:2px;cursor:pointer;color:black' class='col-xs-4' ><button id='classX_report' style='background-color:rgba(151,94,151,1);border-color:black;border-radius:3px' class='ripple'>reports</button></div></div></div><div style='overflow-y:hidden;background-color:rgba(151,94,151,1);' class='col-md-5 col-xs-12 col-xs-offset-1 panel panel2 text-center'> <div class='row'><h5 style='color:black;display:block;margin-top:0;font-weight:bold;font-size:22px;' class='classHead0'>Class X</h5></div><div class='row class_info' style='display:block;background-color:white;font-size:16px;'> <div class='col-xs-6 text-center'>subject:</div><div class='col-xs-6 text-danger' id='subject0'></div><br><br><div class='col-xs-6 text-center'>strength:</div><div class='col-xs-6' id='strength0'></div><br><br><div class='col-xs-6 text-center'>classes held:</div><div class='col-xs-6' id='classesHeld0'></div><br><br><div class='col-xs-6 text-center'>first class:</div><div class='col-xs-6' id='firstClass0'></div></div><div class='col-xs-12 text-center' style='font-size:110%;font-weight:bold;margin-top:5px;'> <div style='border-radius:2px;cursor:pointer;color:black' class='col-xs-7' id='classX'>attendance</div><div style='border-radius:2px;cursor:pointer;color:black' class='col-xs-offset-1 col-xs-4' id='classX_report'>report</div></div></div><div style='background-color:rgba(151,94,151,1);' class='col-md-3 col-xs-12 col-xs-offset-1 panel panel_setting text-center'> <h4 style='color:black;font-weight:bold'>Setting</h4> <hr style='box-shadow: 5px .5px 10px lightgrey'> <div style='background-color:white;font-size:16px' class='row'> <p> <div style='color:rgb(91,216,158)' class='setting' id='add_staff'>Add Student</div></p><p> <div style='color:rgb(91,216,158)' class='setting' id='remove_staff'>Remove Student</div></p><p> <div style='color:rgb(91,216,158)' class='setting' id='remove_staff'>Edit Student Record</div></p><p> <div style='color:rgb(91,216,158)' class='setting' id=>Submit Report to HOD</div></p><p> <div style='color:rgb(91,216,158)' class='setting'>Change Password</div></p></div></div><div style='background-color:rgba(151,94,151,1);' class='col-md-7 col-md-offset-1 col-xs-12 col-xs-offset-1 panel text-center'> <div class='row' style='color:black;font-size:24px;font-weight:bold' class='col-xs-12'><div class='col-xs-12'>Reports</div></div><div class='row' style='background-color:white;height:40%;overflow-y:auto;'> <div class='col-xs-12 text-center' style='font-size:150%;' id='showReport'><div style='opacity:.7;position:relative;top:100px;'>select batch</div></div></div></div></div></div><div class='col-md-3 col-xs-12'> <div style='background-color:rgba(151,94,151,1);' class='col-md-12 panel text-center col-xs-12'> <div style='color:black;font-size:160%;'>Name</div><hr style='box-shadow: 5px .5px 10px lightgrey'> <div style='background-color:white;font-size:110%' class='row panel_dept_info'> <div class='col-xs-5 text-center'>Department</div><div class='col-xs-7 text-danger' id='department'></div><br><br><div class='col-xs-5 text-center'>Joined:</div><div class='col-xs-7' id='joined'></div><br><br><div class='col-xs-5 text-center'>Classes:</div><div class='col-xs-7' id='classes'></div><br><br><div class='col-xs-5 text-center'>Status:</div><div class='col-xs-7 text-info' id='status'></div><br><br><div class='col-xs-5 text-center'>subjects A:</div><div class='col-xs-7 text-info' id='subjectA'></div><br><br><div class='col-xs-5 text-center'>subjects B:</div><div class='col-xs-7 text-info' id='subjectB'></div></div></div><div style='background-color:rgba(151,94,151,1);max-height:150px;' class='col-md-12 panel text-center col-xs-12'> <h4 style='color:black;font-weight:bold;'>Time Table</h4> <div style='background-color:white;' class='row time_table'> </div></div></div>",

					loadHome: function(){
						document.getElementById("nextSection").innerHTML = view.home;
						controller.present.students = [];
						controller.facultyData();
					},

					showReport:function(x){
						document.getElementById("showReport").innerHTML = x;
					},

					updateFacultyData: function(){
						console.log(model);
							for(var i=0;i<1;i++){
									document.getElementsByClassName('classHead'+i)[0].innerHTML = model.classX.semester + "th Sem, " + model.classX.branch ;
									document.getElementById('subject'+i).innerHTML = model.classX.subject;
									document.getElementById('strength'+i).innerHTML = model.classX.strength;
									document.getElementById('classesHeld'+i).innerHTML = model.classX.classesHeld;
									document.getElementById('firstClass'+i).innerHTML = model.classX.firstClass;
							}
					},

					updatePersonalInfo: function(){
						document.getElementById('department').innerHTML = model.personalInfo.department;
						document.getElementById('joined').innerHTML = model.personalInfo.joined;
						document.getElementById('status').innerHTML = model.personalInfo.status;
						document.getElementById('classes').innerHTML = model.personalInfo.classes;
						document.getElementById('subjectA').innerHTML = model.personalInfo.subjectA;
						document.getElementById('subjectB').innerHTML = model.personalInfo.subjectB;
					}
		};

		var model = {
			months: ["january","february","march"],
			user:"<%= user %>",
			students: [],

				classX: {
						batch:'',
						subject:'',
						strength:'',
						classesHeld:'',
						firstClass:''
				},

				classY: {
						batch:'',
						subject:'',
						strength:'',
						classesHeld:'',
						firstClass:''
				},

				personalInfo: {
					name: "",
					department: "",
					joined: "",
					status: "",
					subjectA: "",
					subjectB: ""
				}
		};

		var controller = {
			present: {students:[]},

			facultyData: function(){
				var requestFacultyData = new XMLHttpRequest();

				if(!requestFacultyData){
					alert('error')
				}

				requestFacultyData.open('GET','http://localhost:3000/faculty/requestFacultyData',true);
				requestFacultyData.send(null)

				requestFacultyData.onreadystatechange = function(){
					var response = requestFacultyData.response;
					if( requestFacultyData.status === 200 && requestFacultyData.readyState === XMLHttpRequest.DONE){
						if(response == '0' ){
							document.getElementById('notification_box').innerHTML = 'no notifications'
						} else {
							response = JSON.parse(response);
							model.personalInfo.name = response.name;
							model.personalInfo.department = response.department;
							model.personalInfo.joined = response.joined;
							model.personalInfo.college = response.college;
							model.personalInfo.status = response.status;
							model.personalInfo.subjectA = response.current_classes[0].subject;

							console.log(response);
							response.current_classes.forEach(function(x,i){
									model.classX.batch = x.batch;
									model.classX.branch = x.branch.toLowerCase();
									model.classX.semester = x.semester;
									model.personalInfo.classes = x.branch + ', ' + x.semester + 'th Sem';
									model.classX.subject = x.subject.toUpperCase();
									model.classX.strength = x.strength;
									model.classX.classesHeld = x.classes_held.length;
									model.classX.firstClass = x.classes_held[0];
							})
							view.updateFacultyData();
							view.updatePersonalInfo();
							document.getElementById('classX').onclick = controller.getStudentList;
							document.getElementById('classX_report').onclick = controller.getReport;

						}
					}
				}

			},

			getStudentList: function(e){
				var id = e.target.id
				console.log(id)
				var inf = model[id]
				console.log(inf)
				var attendance = new XMLHttpRequest();

				attendance.onreadystatechange = function(){
					var response = attendance.response;
					var students = [];
					if( attendance.status === 200 && attendance.readyState === XMLHttpRequest.DONE){
						if(response == '0' ){
							document.getElementById('notification_box').innerHTML = 'no notifications'
						} else {
							response = JSON.parse(response);
							model.students = response;

							response.forEach(function(student){
								students.push(student.name);
							});
							console.log(model.students);
							controller.takeAttendance();


						}
				} else {
					
				}
			}

				attendance.open('GET','http://localhost:3000/faculty/getStudentList/' + model.personalInfo.college + "/" + inf.batch + '/' + inf.branch,true);
				attendance.send(null);
		},

		takeAttendance: function(){
			var name = "";
			model.students.forEach(function(student,i){
				console.log(student)
				name += "<div class='col-xs-12 names' style='color:black;background-color:rgba(255,51,51,0.9);font-size:130%;margin-top:1%;' " + "id=#" + i + ">" + student.name + "</div>";
			})
			document.getElementById("nextSection").innerHTML = "<div style='height:70%;background-color:rgba(151,94,151,1);' class='col-md-4 col-xs-8 col-xs-offset-2 col-md-offset-4 panel panel2 text-center'> <h5 style='color:black;display:block;margin-top:0;font-weight:bold;'>student list</h5> <div class='row student_list' style='height:80%;display:block;background-color:white;font-size:14px;' onclick='controller.markPresent(event)'>" + name + "</div><div style='position:relative;top:4%;font-size:16px'> <div style='border-radius:2px;cursor:pointer;color:black' class='col-xs-6' onclick='controller.submitData()'>submit</div><div style='border-radius:2px;cursor:pointer;color:black' class='col-xs-offset-1 col-xs-4' onclick='view.loadHome()'>abort</div></div></div>";
		},
//"<div style='text-align:center;position:absolute;top:30%;background-color:lightblue;color:black;border-radius:3px;' class='text-center col-xs-10 col-xs-offset-1 col-md-4 col-md-offset-4'><div class='row'><h3 class='col-xs-12'>" + model.students[this.count].name + "</h3></div><div style='background-color:rgba(231,228,230,1);' class='row'><a class='col-xs-4 col-xs-offset-1 text-danger' style='font-size:20px;border-radius:5px;margin-top:15px;margin-bottom:15px;background-color: rgba(151,94,151,1)' id='absent' onclick='controller.markAbsent()'>Absent</a><a class='col-xs-4 col-xs-offset-2 text-info' style='font-size:20px;border-radius:5px;margin-top:15px;margin-bottom:15px;background-color: rgba(151,94,151,1)' id='present' onclick='controller.markPresent()'>Present</a></div></div>"
		markPresent: function(e){
			var e = e.target.id;
			console.log(document.getElementById(e).innerHTML);
			if(this.present.students.indexOf(document.getElementById(e).innerHTML)<0){
				document.getElementById(e).style.backgroundColor= "lightgreen";
				document.getElementById(e).style.color= "white";
				this.present.students.push(document.getElementById(e).innerHTML);
			} else {
				document.getElementById(e).style.backgroundColor= "rgba(255,51,51,0.9)";
				document.getElementById(e).style.color= "white";
				this.present.students.splice(this.present.students.indexOf(document.getElementById(e).innerHTML),1);
			}
			console.log(this.present.students)
		},

		submitData: function(){
			this.present.subject = model.classX.subject
			this.present.user = model.user
			this.present.month = (new Date()).getMonth();
			this.present.date = (new Date()).getDate();
			console.log(JSON.stringify(this.present))
			var SAD = new XMLHttpRequest();

			SAD.onreadystatechange = function(){
				if(SAD.readyState == 4 || SAD.status == 200){
					view.loadHome();
				} else {
					console.log("sending data");
				}
			}

			SAD.open("POST","http://localhost:3000/faculty/submitData/uit-rgpv/ec-a/14",true)
			SAD.setRequestHeader('Content-Type','application/json');
			SAD.send(JSON.stringify(this.present))
		},

		getReport: function(e){
			var e = e.target.id
			e = e.split('_')
			e = e[0]
			console.log(e)
			var requestReport = new XMLHttpRequest();

			requestReport.onreadystatechange = function(){
				if(requestReport.readyState == 4 || requestReport.status == 200){
					var reportData = JSON.parse(requestReport.response);
					console.log(reportData);
					var x = "<table class='table-responsive table-striped' class='col-xs-12'><tr class='row' style='font-size:18px;'><th class='col-xs-4 text-center'>Name</th><th class='col-xs-4 text-center'>Attendance</th><th class='col-xs-4 text-center'>Percentage</th></tr>";
					var max = 1;
					reportData.attendance.forEach(function(student){
						var count = 0;
						if(student[model[e].subject] === undefined){
							 student[model[e].subject] = [];
						 }

						 for(var props in student[model[e].subject]){
							 if( model.months.indexOf(props)>=0 ){
								 count += student[model[e].subject][props].length;
								 console.log(student[model[e].subject][props].length);
							 }
						 }
						if(count>max){
							max = count;
						}
					});
					reportData.attendance.forEach(function(student){
						var count = 0;
						if(student[model[e].subject] === undefined){
							 student[model[e].subject] = [];
						 }

						 for(var props in student[model[e].subject]){
							 if( model.months.indexOf(props)>=0 ){
								 count += student[model[e].subject][props].length;
								 console.log(student[model[e].subject][props].length);
							 }
						 }
						 console.log(max);
						 x += "<tr style='font-size:14px;font-family:notosans;' class='row'><td class='col-xs-4 text-center'>" + student.name + "</td><td class='col-xs-4 text-center'>" + count + "</td><td class='col-xs-4 text-center'>" + (count/max)*100 + "</td></tr>";
					})
					x += "</table>";
					view.showReport(x);
				} else {
					document.getElementById("showReport").innerHTML = "<div><img src='img/loader.gi'></div>";
				}
			}

			requestReport.open("GET","http://localhost:3000/faculty/report/" + model.personalInfo.college + "/" + model[e].branch + "/"+ model[e].batch + "/" + model[e].subject,true);
			requestReport.send(null);
		}	};

		window.onload = view.loadHome;

		</script>

	</head>
	<body>
		<div class='container-fluid'>

		<!-- new row, for name of the Home Company -->
				<div class='row' id='navbar'>

					<h5 class='col-lg-4 col-xs-12' id='company' style='color:black'><b>Site Under Construction</b> <small style='color:rgb(191,26,15)'><%= title %></small></h5>

				</div>

		</div>

		<div class='container-fluid'>
							<div class='row'  id='nextSection'>


							</div>
		</div>

	</body>
</html>
