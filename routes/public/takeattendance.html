<html>
	<head>
		<title>Oniv | Take Attendance</title>
		<link href='css/bootstrap.css' type='text/css' rel='stylesheet'>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

		<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
		<style>
			body {
				font-family: Lato;
			}

			input {
				width: 100%;
				border-radius: 5px;
				padding: 10px;
				border: solid 1px rgb(160,160,160);
			}

			#batches {
				color: rgb(66, 179, 244);
				cursor: pointer;
			}
		</style>
		<script>
			let model = {bts:[]}
			let view = {
				parseData: function(){
					let btc = "<div class='row'>";
					let stds = "<div class='row'>";
					model.bts.forEach(function(x,i){
						btc += "<div class='col-xs-12 " + x._id + "'>" + x._id + "</div>";
						model.als[x._id].forEach((y,n)=>{
							stds += "<div class='col-xs-12 " + y.enroll_number + " " + x._id + "' batch='" + x._id + "'>" + y.name + "</div>";
						})
					})
					model.als.forEach(function(y,n){

					})
					stds += "</div>";
					btc += "</div>";
					document.getElementById('batches').innerHTML = btc;
					document.getElementById('student-list').innerHTML = stds;
				},

				getAllBatchesData: function(){
					let c = 0;
					model.als = [];
					model.bts.forEach((x,i)=>{
						let xhr = new XMLHttpRequest();
						xhr.onreadystatechange = function(){
							if(xhr.readyState === 4 && xhr.status === 200){
								const resp = JSON.parse(xhr.response)
								model.als[resp._id] = resp.students;
								c++ ;
								if(c===model.bts.length){
									view.parseData();
								}
							}
						}
						xhr.open('GET',"http://localhost:80/admin/getBatchData/" + x._id,true);
						xhr.send(null);
					})
				}
			}
			window.onload = function(){
				let xhr = new XMLHttpRequest();
				xhr.onreadystatechange = function(){
					if(xhr.readyState === 4 && xhr.status === 200){
						model.bts = JSON.parse(xhr.response).batches;
						view.getAllBatchesData();
					}
				}
				xhr.open('GET',"http://localhost:80/admin/getallstudents",true);
				xhr.send(null);
			}
		</script>
	</head>
	<body>
		<div class="container-fluid">
			<div class="row text-center">
				<div class="col-xs-12">
					<div class="row" style="margin-top:50px;">
						<div class="col-xs-6">
							<div class="row">
								<div class='col-xs-8 col-xs-offset-2'>
									<input type="text" placeholder="Search by Name">
								</div>
							</div>
						</div>
						<div class="col-xs-6">
							<div class="row">
								<div class='col-xs-8 col-xs-offset-2'>
									<input type="text" placeholder="Search by Enroll Number">
								</div>
							</div>
						</div>
					</div>
					<div class="row" style="margin-top:100px;height:300px">
						<div class="col-xs-2 text-center" id="batches" style="margin-top:20px;border-right: solid 1px rgb(200,200,200)">

						</div>
						<div class="col-xs-6" id="student-list">

						</div>
						<div class="col-xs-3" id="student-info">

						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
